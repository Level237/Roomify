
{% load static %}
<nav class="navbar sidebar navbar-expand-xl navbar-light">
    <!-- Navbar brand for xl START -->
    <div class="d-flex align-items-center px-3 py-2">
        <a class="navbar-brand" href="#">
            <img class="light-mode-item navbar-brand-item" src="{% static 'images/logo-light.png' %}" alt="logo" height="40">
             <img class="dark-mode-item navbar-brand-item" src="{% static 'images/logo.png' %}" alt="logo" height="40">
        </a>
    </div>

    <div class="offcanvas offcanvas-start flex-row custom-scrollbar h-100" data-bs-backdrop="true" tabindex="-1" id="offcanvasSidebar">
        <div class="offcanvas-body sidebar-content d-flex flex-column">
            <!-- Hotel Selector -->
            <div class="p-3 border-bottom">
                <div class="dropdown" style="position: relative;">
                    <button class="btn btn-outline-primary w-100 text-start d-flex align-items-center justify-content-between" 
                            type="button" id="hotelDropdown" data-bs-toggle="dropdown" aria-expanded="false"
                            style="z-index: 1060;">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-building me-2"></i>
                            <span style="font-size: 13px;" class="text-truncate" id="currentHotel">Sélectionner un hôtel</span>
                        </div>
                        <i class="bi bi-chevron-down ms-2"></i>
                    </button>
                    <ul class="dropdown-menu w-100" aria-labelledby="hotelDropdown" style="position: absolute; z-index: 1070;">
                        <li><a class="dropdown-item" href="#" data-hotel="all">Vue globale</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a style="font-size: 15px;" class="dropdown-item d-flex align-items-center" href="#" data-hotel="1">
                            <i class="bi bi-building me-2"></i> Hôtel des Palmiers
                            <span class="badge bg-primary ms-auto">Actif</span>
                        </a></li>
                        <li><a style="font-size: 15px;" class="dropdown-item d-flex align-items-center" href="#" data-hotel="2">
                            <i class="bi bi-building me-2"></i> Hôtel du Lac
                        </a></li>
                        <li><a style="font-size: 15px;" class="dropdown-item d-flex align-items-center" href="#" data-hotel="3">
                            <i class="bi bi-building me-2"></i> Hôtel Montagne
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item text-primary" href="?r=new-hotel">
                                <i class="bi bi-plus-circle me-2"></i>Ajouter un hôtel
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Navigation Menu -->
            <ul class="navbar-nav flex-column flex-grow-1" id="navbar-sidebar">
                <li class="nav-item">
                    <a class="nav-link active" href="#">
                        <i class="bi bi-speedometer2 me-2"></i> Tableau de bord
                    </a>
                </li>
                
                <li class="nav-item mt-2">
                    <div class="nav-link text-uppercase small fw-bold text-muted">Gestion</div>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="#">
                        <i class="bi bi-calendar-check me-2"></i> Réservations
                        <span class="badge bg-primary rounded-pill float-end">12</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="#">
                        <i class="bi bi-people me-2"></i> Clients
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="#">
                        <i class="bi bi-door-open me-2"></i> Chambres
                    </a>
                </li>
                
                <li class="nav-item mt-2">
                    <div class="nav-link text-uppercase small fw-bold text-muted">Analyse</div>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="#">
                        <i class="bi bi-graph-up me-2"></i> Statistiques
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="#">
                        <i class="bi bi-currency-dollar me-2"></i> Revenus
                    </a>
                </li>
                
                <li class="nav-item mt-auto">
                    <a class="nav-link" href="#">
                        <i class="bi bi-gear me-2"></i> Paramètres
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- User Profile & Logout -->
        <div class="p-3 border-top">
            <div class="d-flex align-items-center">
                <img src="{% static 'images/avatar/01.jpg' %}" class="rounded-circle me-2" width="36" height="36" alt="Avatar">
                <div class="flex-grow-1">
                    <h6 class="mb-0">{{ user.get_full_name|default:user.username }}</h6>
                    <small class="text-muted">Manager</small>
                </div>
                <a href="{% url 'accounts:logout' %}" class="btn btn-sm btn-link text-danger" data-bs-toggle="tooltip" title="Déconnexion">
                    <i class="bi bi-box-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>
</nav>

{% if show_hotel_form %}
<!-- Overlay avec backdrop -->
<div class="modal-backdrop-custom fade show"></div>

<!-- Modal personnalisé superposé -->
<div class="custom-modal-overlay">
    <div class="custom-modal-container">
        <div class="custom-modal-content">
            <!-- En-tête du formulaire -->
            <div class="custom-modal-header bg-primary bg-gradient text-white">
                <div class="d-flex align-items-center">
                    <i class="bi bi-building-add me-2 fs-4"></i>
                    <h5 class="mb-0">Nouvel Hôtel</h5>
                </div>
                <a href="{% url 'managerpanel:manager_dashboard' %}" class="btn-close btn-close-white" aria-label="Close"></a>
            </div>

            <!-- Écran de chargement -->
            <div id="hotelFormLoader" class="d-none">
                <div class="custom-modal-body text-center py-5">
                    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Chargement...</span>
                    </div>
                    <p class="mt-3 text-muted">Création de votre hôtel en cours...</p>
                </div>
            </div>
            
            <!-- Contenu du formulaire -->
            <div id="hotelFormContent">
                <form id="addHotelForm" class="needs-validation" novalidate>
                    <div class="custom-modal-body">
                        <div class="row g-4">
                            <!-- Section Informations de base -->
                            <div class="col-md-8">
                                <div class="card h-100 border-0 shadow-sm">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="bi bi-info-circle me-2"></i>Informations de base</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="hotelName" class="form-label">Nom de l'hôtel <span class="text-danger">*</span></label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="bi bi-building"></i></span>
                                                <input type="text" class="form-control" id="hotelName" placeholder="Ex: Hôtel des Palmiers" required>
                                                <div class="invalid-feedback">Veuillez saisir le nom de l'hôtel</div>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="hotelLocation" class="form-label">Adresse <span class="text-danger">*</span></label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="bi bi-geo-alt"></i></span>
                                                <input type="text" class="form-control" id="hotelLocation" placeholder="Adresse complète" required>
                                                <div class="invalid-feedback">Veuillez saisir l'adresse de l'hôtel</div>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="hotelEmail" class="form-label">Email de contact <span class="text-danger">*</span></label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="bi bi-envelope"></i></span>
                                                <input type="email" class="form-control" id="hotelEmail" placeholder="contact@hotel.com" required>
                                                <div class="invalid-feedback">Veuillez saisir un email valide</div>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="hotelPhone" class="form-label">Téléphone <span class="text-danger">*</span></label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="bi bi-telephone"></i></span>
                                                <input type="tel" class="form-control" id="hotelPhone" placeholder="+33 1 23 45 67 89" required>
                                                <div class="invalid-feedback">Veuillez saisir un numéro de téléphone valide</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Section Médias -->
                            <div class="col-md-4">
                                <div class="card h-100 border-0 shadow-sm">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="bi bi-images me-2"></i>Médias</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="text-center mb-4">
                                            <div class="position-relative d-inline-block">
                                                <img id="hotelLogoPreview" src="https://via.placeholder.com/200x150?text=Logo" 
                                                     class="img-thumbnail rounded-3 mb-2" 
                                                     style="width: 200px; height: 150px; object-fit: cover;">
                                                <label for="hotelLogo" class="position-absolute bottom-0 end-0 bg-primary text-white rounded-circle p-2" 
                                                       style="cursor: pointer;" title="Changer le logo">
                                                    <i class="bi bi-camera"></i>
                                                    <input type="file" id="hotelLogo" class="d-none" accept="image/*">
                                                </label>
                                            </div>
                                            <div class="small text-muted">Format recommandé : 400x300px</div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="hotelDescription" class="form-label">Description</label>
                                            <textarea class="form-control" id="hotelDescription" rows="4" placeholder="Décrivez brièvement votre établissement"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Section Services -->
                         
                        </div>
                    </div>
                    
                    <div class="custom-modal-footer bg-light">
                        <a href="{% url 'managerpanel:manager_dashboard' %}" class="btn btn-light">
                            <i class="bi bi-x-lg me-1"></i> Annuler
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save me-1"></i> Enregistrer l'hôtel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Message de succès -->
<div id="successMessage" class="position-fixed top-0 end-0 p-3" style="z-index: 10000; display: none;">
    <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header bg-success text-white">
            <i class="bi bi-check-circle-fill me-2"></i>
            <strong class="me-auto">Succès</strong>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
            L'hôtel a été créé avec succès !
        </div>
    </div>
</div>

<!-- Styles CSS pour le modal personnalisé -->
<style>
    /* Backdrop sombre */
    .modal-backdrop-custom {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1050;
        backdrop-filter: blur(3px);
    }

    .modal-backdrop-custom.fade {
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .modal-backdrop-custom.show {
        opacity: 1;
    }

    /* Container du modal */
    .custom-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1055;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
        overflow-y: auto;
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    .custom-modal-container {
        width: 100%;
        max-width: 1200px;
        margin: auto;
        animation: slideDown 0.4s ease;
    }

    @keyframes slideDown {
        from {
            transform: translateY(-50px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .custom-modal-content {
        background: white;
        border-radius: 0.5rem;
        box-shadow: 0 1rem 3rem rgba(0, 0, 0, 0.3);
        max-height: 90vh;
        display: flex;
        flex-direction: column;
    }

    .custom-modal-header {
        padding: 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-radius: 0.5rem 0.5rem 0 0;
    }

    .custom-modal-body {
        padding: 1.5rem;
        overflow-y: auto;
        max-height: calc(90vh - 180px);
    }

    .custom-modal-footer {
        padding: 1rem 1.5rem;
        border-top: 1px solid #dee2e6;
        display: flex;
        justify-content: flex-end;
        gap: 0.5rem;
        border-radius: 0 0 0.5rem 0.5rem;
    }

    /* Scrollbar personnalisée pour le modal */
    .custom-modal-body::-webkit-scrollbar {
        width: 8px;
    }

    .custom-modal-body::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    .custom-modal-body::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 10px;
    }

    .custom-modal-body::-webkit-scrollbar-thumb:hover {
        background: #555;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .custom-modal-container {
            max-width: 100%;
        }

        .custom-modal-content {
            max-height: 100vh;
            border-radius: 0;
        }

        .custom-modal-body {
            max-height: calc(100vh - 180px);
        }
    }
</style>

<!-- Script pour gérer la soumission du formulaire -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('addHotelForm');
    const loader = document.getElementById('hotelFormLoader');
    const successMessage = document.getElementById('successMessage');
    const hotelLogoInput = document.getElementById('hotelLogo');
    const hotelLogoPreview = document.getElementById('hotelLogoPreview');
    
    // Empêcher le scroll du body quand le modal est ouvert
    document.body.style.overflow = 'hidden';

    // Gestion de l'aperçu du logo
    if (hotelLogoInput) {
        hotelLogoInput.addEventListener('change', function(e) {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    hotelLogoPreview.src = e.target.result;
                }
                reader.readAsDataURL(this.files[0]);
            }
        });
    }
    
    // Gestion de la soumission du formulaire
    if (form) {
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!form.checkValidity()) {
                e.stopPropagation();
                form.classList.add('was-validated');
                return;
            }
            
            // Afficher le loader
            document.getElementById('hotelFormContent').classList.add('d-none');
            loader.classList.remove('d-none');
            
            try {
                // Ici, vous feriez normalement un appel AJAX
                // const formData = new FormData(form);
                // await fetch('/api/hotels', { method: 'POST', body: formData });
                
                // Simulation d'un délai
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Afficher le message de succès
                successMessage.style.display = 'block';
                
                // Rediriger après 2 secondes
                setTimeout(() => {
                    window.location.href = "{% url 'managerpanel:manager_dashboard' %}";
                }, 2000);
                
            } catch (error) {
                console.error('Erreur:', error);
                // Gérer l'erreur
                alert('Une erreur est survenue lors de la création de l\'hôtel.');
                loader.classList.add('d-none');
                document.getElementById('hotelFormContent').classList.remove('d-none');
            }
        });
    }

    // Fermer le modal avec la touche Échap
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            window.location.href = "{% url 'managerpanel:manager_dashboard' %}";
        }
    });
});
</script>
{% endif %}



