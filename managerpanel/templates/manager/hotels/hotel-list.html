{% extends 'layouts/manager/main.html' %}
{% load static %}
{% block title %}Mes Hôtels{% endblock %}

{% block content %}
<div class="page-content-wrapper p-xxl-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                <div>
                    <h1 class="h3 mb-1">Mes Hôtels</h1>
                    <p class="text-muted mb-0">Gérez tous vos établissements en un seul endroit</p>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-secondary">
                        <i class="bi bi-funnel me-2"></i>Filtrer
                    </button>
                    <a href="?r=new-hotel" class="btn btn-primary">
                        <i class="bi bi-plus-lg me-2"></i>Ajouter un hôtel
                    </a>
                </div>
            </div>
        </div>
    </div>

    
    <!-- Stats Overview -->
   

    {% if hotels.count == 0 %}
    <!-- Empty State -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center py-5">
                    <div class="empty-state-container">
                        <!-- Illustration/Icon -->
                        <div class="empty-state-icon mb-4">
                            <div class="position-relative d-inline-block">
                                <div class="icon-circle-bg"></div>
                                <i class="bi bi-building position-relative" style="font-size: 4rem; color: var(--bs-primary);"></i>
                            </div>
                        </div>
                        
                        <!-- Title & Description -->
                        <h3 class="mb-3">Aucun hôtel trouvé</h3>
                        <p class="text-muted mb-4 mx-auto" style="max-width: 500px;">
                            Vous n'avez pas encore ajouté d'hôtel à votre compte. 
                            Commencez dès maintenant en créant votre premier établissement.
                        </p>
                        
                        <!-- CTA Button -->
                        <a href="?r=new-hotel" class="btn btn-primary btn-lg px-4 py-3">
                            <i class="bi bi-plus-circle me-2"></i>Créer mon premier hôtel
                        </a>
                        
                        <!-- Additional Info -->
                        <div class="mt-5 pt-4 border-top d-inline-block">
                            <p class="text-muted small mb-3">
                                <i class="bi bi-lightbulb me-2"></i>Besoin d'aide pour commencer ?
                            </p>
                            <div class="d-flex gap-3 justify-content-center flex-wrap">
                                <a href="#" class="text-decoration-none small">
                                    <i class="bi bi-book me-1"></i>Guide de démarrage
                                </a>
                                <a href="#" class="text-decoration-none small">
                                    <i class="bi bi-play-circle me-1"></i>Voir la vidéo
                                </a>
                                <a href="#" class="text-decoration-none small">
                                    <i class="bi bi-question-circle me-1"></i>Centre d'aide
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% else %}

     <div class="row g-3 mb-4">
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="icon-shape icon-lg bg-primary bg-opacity-10 text-primary rounded-3 me-3">
                            <i class="bi bi-building fs-5"></i>
                        </div>
                        <div>
                            <h6 class="text-uppercase text-muted mb-1 small">Total Hôtels</h6>
                            <h3 class="mb-0">{{total_hotels}}</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="icon-shape icon-lg bg-success bg-opacity-10 text-success rounded-3 me-3">
                            <i class="bi bi-check-circle fs-5"></i>
                        </div>
                        <div>
                            <h6 class="text-uppercase text-muted mb-1 small">Actifs</h6>
                            <h3 class="mb-0">{{total_hotels_is_active}}</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="icon-shape icon-lg bg-warning bg-opacity-10 text-warning rounded-3 me-3">
                            <i class="bi bi-pause-circle fs-5"></i>
                        </div>
                        <div>
                            <h6 class="text-uppercase text-muted mb-1 small">Inactifs</h6>
                            <h3 class="mb-0">{{total_hotels_is_not_active}}</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="icon-shape icon-lg bg-info bg-opacity-10 text-info rounded-3 me-3">
                            <i class="bi bi-door-open fs-5"></i>
                        </div>
                        <div>
                            <h6 class="text-uppercase text-muted mb-1 small">Total Chambres</h6>
                            <h3 class="mb-0">{{total_rooms}}</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Hotels Grid -->
    <div class="row g-4">
        {% include 'manager/hotels/partials/hotel-card.html' %}
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* Hotel Cards */
    .hotel-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .hotel-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.15) !important;
    }
    .hotel-img {
        transition: transform 0.3s ease;
    }
    .hotel-card:hover .hotel-img {
        transform: scale(1.05);
    }
    
    /* Icon Shapes */
    .icon-shape {
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }
    .icon-lg {
        width: 48px;
        height: 48px;
    }
    .icon-xl {
        width: 64px;
        height: 64px;
    }
    .icon-xxl {
        width: 80px;
        height: 80px;
    }
    
    /* Hover Effects */
    .hover-lift {
        transition: all 0.3s ease;
    }
    .hover-lift:hover {
        transform: translateY(-3px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1) !important;
    }
    
    /* Form Switch */
    .form-check-input:checked {
        background-color: var(--bs-success);
        border-color: var(--bs-success);
    }
    
    /* Switch Hotel Button Styles */
    .switch-hotel-btn {
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.3s ease;
        border-width: 2px;
    }
    
    .switch-hotel-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(var(--bs-primary-rgb), 0.2);
    }
    
    .switch-hotel-btn:active {
        transform: translateY(0);
    }
    
    .switch-hotel-btn i {
        transition: transform 0.3s ease;
    }
    
    .switch-hotel-btn:hover i {
        transform: rotate(180deg);
    }
    
    .btn-success[disabled] {
        opacity: 1;
        cursor: not-allowed;
    }
    
    .switch-hotel-form {
        margin: 0;
    }
    
    /* Empty State Styles */
    .empty-state-container {
        padding: 3rem 1.5rem;
        animation: fadeInUp 0.6s ease-out;
    }
    
    .empty-state-icon {
        position: relative;
        animation: bounceIn 0.8s ease-out;
    }
    
    .icon-circle-bg {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 120px;
        height: 120px;
        background: linear-gradient(135deg, var(--bs-primary-bg-subtle), var(--bs-primary-border-subtle));
        border-radius: 50%;
        opacity: 0.3;
        animation: pulse 2s ease-in-out infinite;
    }
    
    .empty-state-container h3 {
        font-weight: 600;
        color: var(--bs-heading-color);
    }
    
    .empty-state-container .btn-primary {
        font-weight: 500;
        box-shadow: 0 4px 12px rgba(var(--bs-primary-rgb), 0.3);
        transition: all 0.3s ease;
    }
    
    .empty-state-container .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(var(--bs-primary-rgb), 0.4);
    }
    
    .empty-state-container a:not(.btn) {
        color: var(--bs-primary);
        transition: all 0.2s ease;
    }
    
    .empty-state-container a:not(.btn):hover {
        color: var(--bs-primary);
        text-decoration: underline !important;
    }
    
    /* Animations */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes bounceIn {
        0% {
            opacity: 0;
            transform: scale(0.3);
        }
        50% {
            opacity: 1;
            transform: scale(1.05);
        }
        70% {
            transform: scale(0.9);
        }
        100% {
            transform: scale(1);
        }
    }
    
    @keyframes pulse {
        0%, 100% {
            transform: translate(-50%, -50%) scale(1);
            opacity: 0.3;
        }
        50% {
            transform: translate(-50%, -50%) scale(1.1);
            opacity: 0.2;
        }
    }
    
    /* Dark Mode Support */
    [data-bs-theme="dark"] .icon-circle-bg {
        background: linear-gradient(135deg, rgba(var(--bs-primary-rgb), 0.2), rgba(var(--bs-primary-rgb), 0.1));
    }
    
    [data-bs-theme="dark"] .empty-state-container .btn-primary {
        box-shadow: 0 4px 12px rgba(var(--bs-primary-rgb), 0.5);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .empty-state-container {
            padding: 2rem 1rem;
        }
        
        .icon-circle-bg {
            width: 100px;
            height: 100px;
        }
        
        .empty-state-icon i {
            font-size: 3rem !important;
        }
        
        .empty-state-container h3 {
            font-size: 1.5rem;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Gestion du basculement vers un hôtel
    const switchForms = document.querySelectorAll('.switch-hotel-form');
    
    switchForms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const button = this.querySelector('.switch-hotel-btn');
            const icon = button.querySelector('i');
            const span = button.querySelector('span');
            
            // Désactiver le bouton et afficher le chargement
            button.disabled = true;
            icon.className = 'bi bi-arrow-repeat spinner-animation';
            span.textContent = 'Basculement en cours...';
            
            // Le formulaire sera soumis normalement (pas de e.preventDefault())
            // La page se rechargera avec le nouvel hôtel actif
        });
    });
    
    // Animation de rotation pour l'icône de chargement
    const style = document.createElement('style');
    style.textContent = `
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .spinner-animation {
            animation: spin 1s linear infinite;
        }
    `;
    document.head.appendChild(style);
    
    // Fonction pour afficher les toasts
    function showToast(message, type = 'info') {
        const toastHTML = `
            <div class="toast align-items-center text-white bg-${type} border-0" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                    <div class="toast-body">
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            </div>
        `;
        
        let toastContainer = document.querySelector('.toast-container');
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
            document.body.appendChild(toastContainer);
        }
        
        toastContainer.insertAdjacentHTML('beforeend', toastHTML);
        const toastElement = toastContainer.lastElementChild;
        const toast = new bootstrap.Toast(toastElement);
        toast.show();
        
        toastElement.addEventListener('hidden.bs.toast', function () {
            toastElement.remove();
        });
    }
    
    // Afficher un message de succès si l'hôtel a été changé
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('switched') === 'success') {
        showToast('Hôtel basculé avec succès !', 'success');
        // Nettoyer l'URL
        window.history.replaceState({}, document.title, window.location.pathname);
    }
});
</script>
{% endblock %}
